<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ex3. Creating Synthetic Time-Lapse ERT Measurements &mdash; PyHydroGeophysX Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
    <link rel="canonical" href="https://geohang.github.io/PyHydroGeophysX/auto_examples/Ex3_Time_lapse_measurement.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=2389946f"></script>
        <script src="../_static/doctools.js?v=888ff710"></script>
        <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../_static/copybutton.js?v=f281be69"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Ex 2. Complete Workflow: From Hydrological Models to Geophysical Inversion" href="Ex2_workflow.html" />
    <link rel="prev" title="Ex 5. Seismic Refraction Tomography (SRT) Forward Modeling" href="Ex5_SRT.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            PyHydroGeophysX
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Examples Gallery</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Ex1_model_output.html">Ex 1. Loading and Processing Hydrological Model Outputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex7_structure_TLresinv.html">Ex 7. Structure-Constrained Time-Lapse Resistivity Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex4_TL_inversion.html">Ex 4. Time-Lapse ERT Inversion Techniques</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex6_Structure_resinv.html">Ex 6. Structure-Constrained Resistivity Inversion</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex8_MC_WC.html">Ex 8. Monte Carlo Uncertainty Quantification for Water Content Estimation</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex5_SRT.html">Ex 5. Seismic Refraction Tomography (SRT) Forward Modeling</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Ex3. Creating Synthetic Time-Lapse ERT Measurements</a></li>
<li class="toctree-l2"><a class="reference internal" href="Ex2_workflow.html">Ex 2. Complete Workflow: From Hydrological Models to Geophysical Inversion</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PyHydroGeophysX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Examples Gallery</a></li>
      <li class="breadcrumb-item active">Ex3. Creating Synthetic Time-Lapse ERT Measurements</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/geohang/PyHydroGeophysX/blob/main/docs/source/auto_examples/Ex3_Time_lapse_measurement.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p><a class="reference internal" href="#sphx-glr-download-auto-examples-ex3-time-lapse-measurement-py"><span class="std std-ref">Go to the end</span></a>
to download the full example code</p>
</div>
<section class="sphx-glr-example-title" id="ex3-creating-synthetic-time-lapse-ert-measurements">
<span id="sphx-glr-auto-examples-ex3-time-lapse-measurement-py"></span><h1>Ex3. Creating Synthetic Time-Lapse ERT Measurements<a class="headerlink" href="#ex3-creating-synthetic-time-lapse-ert-measurements" title="Permalink to this heading">ÔÉÅ</a></h1>
<p>This example demonstrates how to create synthetic time-lapse electrical
resistivity tomography (ERT) measurements for watershed monitoring applications.</p>
<p>The example covers:
1. Loading time-series water content data from MODFLOW simulations
2. Converting water content to resistivity for each timestep
3. Forward modeling to generate synthetic ERT data for multiple time periods
4. Parallel processing for efficient computation across multiple timesteps
5. Visualization of apparent resistivity changes over time
6. Creating animations showing temporal water content variations</p>
<p>This workflow is essential for testing time-lapse inversion algorithms
and understanding the sensitivity of ERT measurements to hydrological changes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pygimli</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">from</span> <span class="nn">pygimli.physics</span> <span class="kn">import</span> <span class="n">ert</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

<span class="c1"># Setup package path for development</span>
<span class="k">try</span><span class="p">:</span>
    <span class="c1"># For regular Python scripts</span>
    <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="vm">__file__</span><span class="p">))</span>
<span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
    <span class="c1"># For Jupyter notebooks</span>
    <span class="n">current_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>

<span class="c1"># Add the parent directory to Python path</span>
<span class="n">parent_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">current_dir</span><span class="p">)</span>
<span class="k">if</span> <span class="n">parent_dir</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="p">:</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">parent_dir</span><span class="p">)</span>

<span class="c1"># Import PyHydroGeophysX modules</span>
<span class="kn">from</span> <span class="nn">PyHydroGeophysX.model_output.modflow_output</span> <span class="kn">import</span> <span class="n">MODFLOWWaterContent</span>
<span class="kn">from</span> <span class="nn">PyHydroGeophysX.core.interpolation</span> <span class="kn">import</span> <span class="n">ProfileInterpolator</span><span class="p">,</span> <span class="n">create_surface_lines</span>
<span class="kn">from</span> <span class="nn">PyHydroGeophysX.core.mesh_utils</span> <span class="kn">import</span> <span class="n">MeshCreator</span>
<span class="kn">from</span> <span class="nn">PyHydroGeophysX.petrophysics.resistivity_models</span> <span class="kn">import</span> <span class="n">water_content_to_resistivity</span>
<span class="kn">from</span> <span class="nn">PyHydroGeophysX.forward.ert_forward</span> <span class="kn">import</span> <span class="n">ERTForwardModeling</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">output_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span>  <span class="s2">&quot;results&quot;</span><span class="p">,</span> <span class="s2">&quot;TL_measurements&quot;</span><span class="p">)</span> <span class="c1">#&quot;C:/Users/HChen8/Documents/GitHub/PyHydroGeophysX/examples/results/TL_measurements&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Step 1: Set up the ERT profiles like in the workflow example.&quot;</span><span class="p">)</span>

<span class="n">data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">current_dir</span><span class="p">,</span>  <span class="s2">&quot;data&quot;</span><span class="p">)</span> <span class="c1">#&quot;C:/Users/HChen8/Documents/GitHub/PyHydroGeophysX/examples/data/&quot;</span>
<span class="n">modflow_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;modflow&quot;</span><span class="p">)</span>

<span class="c1"># Load domain information from files</span>
<span class="c1"># (Replace with your actual file paths)</span>
<span class="n">idomain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;id.txt&quot;</span><span class="p">))</span>
<span class="n">top</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;top.txt&quot;</span><span class="p">))</span>
<span class="n">porosity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;Porosity.npy&quot;</span><span class="p">))</span>

<span class="c1"># Define profile endpoints</span>
<span class="n">point1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">115</span><span class="p">,</span> <span class="mi">70</span><span class="p">]</span>  <span class="c1"># [col, row]</span>
<span class="n">point2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">180</span><span class="p">]</span>  <span class="c1"># [col, row]</span>

<span class="c1"># Initialize profile interpolator</span>
<span class="n">interpolator</span> <span class="o">=</span> <span class="n">ProfileInterpolator</span><span class="p">(</span>
    <span class="n">point1</span><span class="o">=</span><span class="n">point1</span><span class="p">,</span>
    <span class="n">point2</span><span class="o">=</span><span class="n">point2</span><span class="p">,</span>
    <span class="n">surface_data</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
    <span class="n">origin_x</span><span class="o">=</span><span class="mf">569156.2983333333</span><span class="p">,</span>
    <span class="n">origin_y</span><span class="o">=</span><span class="mf">4842444.17</span><span class="p">,</span>
    <span class="n">pixel_width</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">pixel_height</span><span class="o">=-</span><span class="mf">1.0</span>
<span class="p">)</span>

<span class="c1"># Interpolate porosity to profile</span>
<span class="n">porosity_profile</span> <span class="o">=</span> <span class="n">interpolator</span><span class="o">.</span><span class="n">interpolate_3d_data</span><span class="p">(</span><span class="n">porosity</span><span class="p">)</span>



<span class="c1"># Load structure layers</span>
<span class="n">bot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;bot.npy&quot;</span><span class="p">))</span>

<span class="c1"># Process layers to get structure</span>
<span class="n">structure</span> <span class="o">=</span> <span class="n">interpolator</span><span class="o">.</span><span class="n">interpolate_layer_data</span><span class="p">([</span><span class="n">top</span><span class="p">]</span> <span class="o">+</span> <span class="n">bot</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

<span class="c1"># Create surface lines</span>
<span class="c1"># Indicate the layer for the structure regolith, fractured bedrock and fresh bedrock</span>
<span class="n">top_idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">mid_idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">bot_idx</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
<span class="n">surface</span><span class="p">,</span> <span class="n">line1</span><span class="p">,</span> <span class="n">line2</span> <span class="o">=</span> <span class="n">create_surface_lines</span><span class="p">(</span>
    <span class="n">L_profile</span><span class="o">=</span><span class="n">interpolator</span><span class="o">.</span><span class="n">L_profile</span><span class="p">,</span>
    <span class="n">structure</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
    <span class="n">top_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">mid_idx</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">bot_idx</span><span class="o">=</span><span class="mi">12</span>
<span class="p">)</span>

<span class="c1"># Create mesh</span>
<span class="n">mesh_creator</span> <span class="o">=</span> <span class="n">MeshCreator</span><span class="p">(</span><span class="n">quality</span><span class="o">=</span><span class="mi">32</span><span class="p">)</span>
<span class="n">mesh</span><span class="p">,</span> <span class="n">geom</span> <span class="o">=</span> <span class="n">mesh_creator</span><span class="o">.</span><span class="n">create_from_layers</span><span class="p">(</span>
    <span class="n">surface</span><span class="o">=</span><span class="n">surface</span><span class="p">,</span>
    <span class="n">layers</span><span class="o">=</span><span class="p">[</span><span class="n">line1</span><span class="p">,</span> <span class="n">line2</span><span class="p">],</span>
    <span class="n">bottom_depth</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">line2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">-</span><span class="mi">10</span> <span class="c1">#50.0</span>
<span class="p">)</span>

<span class="c1"># Save mesh</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;mesh.bms&quot;</span><span class="p">))</span>



<span class="n">ID1</span> <span class="o">=</span> <span class="n">porosity_profile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">ID1</span><span class="p">[:</span><span class="n">mid_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">#regolith</span>
<span class="n">ID1</span><span class="p">[</span><span class="n">mid_idx</span><span class="p">:</span><span class="n">bot_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1"># fractured bedrock</span>
<span class="n">ID1</span><span class="p">[</span><span class="n">bot_idx</span><span class="p">:]</span> <span class="o">=</span> <span class="mi">2</span> <span class="c1"># fresh bedrock</span>

<span class="c1"># Get mesh centers and markers</span>
<span class="n">mesh_centers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">cellCenters</span><span class="p">())</span>
<span class="n">mesh_markers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">cellMarkers</span><span class="p">())</span>

<span class="c1"># Interpolate porosity to mesh</span>
<span class="n">porosity_mesh</span> <span class="o">=</span> <span class="n">interpolator</span><span class="o">.</span><span class="n">interpolate_to_mesh</span><span class="p">(</span>
    <span class="n">property_values</span><span class="o">=</span><span class="n">porosity_profile</span><span class="p">,</span>
    <span class="n">depth_values</span><span class="o">=</span><span class="n">structure</span><span class="p">,</span>
    <span class="n">mesh_x</span><span class="o">=</span><span class="n">mesh_centers</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">mesh_y</span><span class="o">=</span><span class="n">mesh_centers</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">mesh_markers</span><span class="o">=</span><span class="n">mesh_markers</span><span class="p">,</span>
    <span class="n">ID</span><span class="o">=</span><span class="n">ID1</span><span class="p">,</span> <span class="c1"># Use ID1 to indicate the layers for interpolation</span>
    <span class="n">layer_markers</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span>

<span class="p">)</span>
<span class="c1"># load water content</span>
<span class="n">Water_Content</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;Watercontent.npy&quot;</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;results/TL_measurements/synwcmodel&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&quot;results/TL_measurements/synresmodel&quot;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1">### comment here to skip the water content and resistivity model generation to save time</span>

<span class="c1"># for i in range(len(Water_Content)):</span>
<span class="c1">#     water_content = Water_Content[i]</span>
<span class="c1">#     # Interpolate water content to profile</span>
<span class="c1">#     water_content_profile = interpolator.interpolate_3d_data(water_content)</span>

<span class="c1">#     # Interpolate water content to mesh</span>
<span class="c1">#     wc_mesh = interpolator.interpolate_to_mesh(</span>
<span class="c1">#         property_values=water_content_profile,</span>
<span class="c1">#         depth_values=structure,</span>
<span class="c1">#         mesh_x=mesh_centers[:, 0],</span>
<span class="c1">#         mesh_y=mesh_centers[:, 1],</span>
<span class="c1">#         mesh_markers=mesh_markers,</span>
<span class="c1">#         ID=ID1,  # Use ID1 to indicate the layers for interpolation</span>
<span class="c1">#         layer_markers=[0, 3, 2],</span>
<span class="c1">#     )</span>

<span class="c1">#     # Convert to resistivity using petrophysical model</span>
<span class="c1">#     marker_labels = [0, 3, 2]  # top, mid, bottom layers</span>
<span class="c1">#     rho_sat = [100, 500, 2400]  # Saturated resistivity for each layer (example values)</span>
<span class="c1">#     n_val = [2.2, 1.8, 2.5]  # Cementation exponent for each layer (example values)</span>
<span class="c1">#     # sigma_s was originally defined as [1/500, 0, 0] but here we use [0.002, 0, 0]</span>
<span class="c1">#     sigma_s = [0.002, 0, 0]</span>

<span class="c1">#     res_models = np.zeros_like(wc_mesh)</span>

<span class="c1">#     mask = (mesh_markers == marker_labels[0])</span>
<span class="c1">#     top_res = water_content_to_resistivity(</span>
<span class="c1">#         wc_mesh[mask],</span>
<span class="c1">#         float(rho_sat[0]),</span>
<span class="c1">#         float(n_val[0]),</span>
<span class="c1">#         porosity_mesh[mask],</span>
<span class="c1">#         sigma_s[0]</span>
<span class="c1">#     )</span>
<span class="c1">#     res_models[mask] = top_res</span>

<span class="c1">#     mask = (mesh_markers == marker_labels[1])</span>
<span class="c1">#     mid_res = water_content_to_resistivity(</span>
<span class="c1">#         wc_mesh[mask],</span>
<span class="c1">#         float(rho_sat[1]),</span>
<span class="c1">#         float(n_val[1]),</span>
<span class="c1">#         porosity_mesh[mask],</span>
<span class="c1">#         sigma_s[1]</span>
<span class="c1">#     )</span>
<span class="c1">#     res_models[mask] = mid_res</span>

<span class="c1">#     mask = (mesh_markers == marker_labels[2])</span>
<span class="c1">#     bot_res = water_content_to_resistivity(</span>
<span class="c1">#         wc_mesh[mask],</span>
<span class="c1">#         float(rho_sat[2]),</span>
<span class="c1">#         float(n_val[2]),</span>
<span class="c1">#         porosity_mesh[mask],</span>
<span class="c1">#         sigma_s[2]</span>
<span class="c1">#     )</span>
<span class="c1">#     res_models[mask] = bot_res</span>

<span class="c1">#     np.save(os.path.join(output_dir, &quot;synwcmodel/synwcmodel&quot; + str(i) ), wc_mesh)</span>
<span class="c1">#     np.save(os.path.join(output_dir, &quot;synresmodel/synresmodel&quot; + str(i) ), res_models)</span>
</pre></div>
</div>
<p>## non parallel computing version
os.makedirs(‚Äúresults/TL_measurements/appres‚Äù, exist_ok=True)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># for i in range(2):</span>
<span class="c1">#     # Create synthetic data</span>

<span class="c1">#     res_model = np.load(os.path.join(output_dir, &quot;synresmodel/synresmodel&quot; + str(i) ))</span>
<span class="c1">#     xpos = np.linspace(15,15+72 - 1,72)</span>
<span class="c1">#     ypos = np.interp(xpos,interpolator.L_profile,interpolator.surface_profile)</span>
<span class="c1">#     pos = np.hstack((xpos.reshape(-1,1),ypos.reshape(-1,1)))</span>

<span class="c1">#     schemeert = ert.createData(elecs=pos,schemeName=&#39;wa&#39;)</span>

<span class="c1">#     # do the forward modeling</span>
<span class="c1">#     mesh.setCellMarkers(np.ones(mesh.cellCount())*2)</span>
<span class="c1">#     grid = pg.meshtools.appendTriangleBoundary(mesh, marker=1,</span>
<span class="c1">#                                             xbound=100, ybound=100)</span>

<span class="c1">#     fwd_operator = ERTForwardModeling(mesh=grid, data=schemeert)</span>

<span class="c1">#     synth_data = schemeert.copy()</span>
<span class="c1">#     fob = ert.ERTModelling()</span>
<span class="c1">#     fob.setData(schemeert)</span>
<span class="c1">#     fob.setMesh(grid)</span>
<span class="c1">#     dr = fob.response(res_model)</span>

<span class="c1">#     dr *= 1. + pg.randn(dr.size()) * 0.05</span>
<span class="c1">#     ert_manager = ert.ERTManager(synth_data)</span>
<span class="c1">#     synth_data[&#39;rhoa&#39;] = dr</span>
<span class="c1">#     synth_data[&#39;err&#39;] = ert_manager.estimateError(synth_data, absoluteUError=0.0, relativeError=0.05)</span>

<span class="c1">#     synth_data.save(os.path.join(output_dir, &quot;appres/synthetic_data&quot;+str(i)+&quot;.dat&quot;))</span>
</pre></div>
</div>
<p>## parallel computing version</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># import os</span>
<span class="c1"># import numpy as np</span>
<span class="c1"># import pygimli as pg</span>
<span class="c1"># from pygimli.physics import ert</span>

<span class="c1"># from joblib import Parallel, delayed</span>

<span class="c1"># def process_timestep(i, output_dir, mesh_array, interpolator_L_profile, interpolator_surface_profile):</span>
<span class="c1">#     &quot;&quot;&quot;Process a single timestep for synthetic data generation&quot;&quot;&quot;</span>
<span class="c1">#     try:</span>
<span class="c1">#         # Load the resistivity model for this timestep</span>
<span class="c1">#         res_model = np.load(os.path.join(output_dir, &quot;synresmodel/synresmodel&quot; + str(i) + &quot;.npy&quot;))</span>

<span class="c1">#         # Create electrode positions</span>
<span class="c1">#         xpos = np.linspace(15, 15+72-1, 72)</span>
<span class="c1">#         ypos = np.interp(xpos, interpolator_L_profile, interpolator_surface_profile)</span>
<span class="c1">#         pos = np.hstack((xpos.reshape(-1,1), ypos.reshape(-1,1)))</span>

<span class="c1">#         # Create ERT data scheme</span>
<span class="c1">#         schemeert = ert.createData(elecs=pos, schemeName=&#39;wa&#39;)</span>

<span class="c1">#         mesh = pg.load(os.path.join(output_dir, &quot;mesh.bms&quot;))</span>
<span class="c1">#         # Set cell markers</span>
<span class="c1">#         mesh.setCellMarkers(np.ones(mesh.cellCount())*2)</span>

<span class="c1">#         # Create boundary mesh</span>
<span class="c1">#         grid = pg.meshtools.appendTriangleBoundary(mesh, marker=1, xbound=100, ybound=100)</span>

<span class="c1">#         # Set up forward operator</span>
<span class="c1">#         fwd_operator = ert.ERTModelling()</span>
<span class="c1">#         fwd_operator.setData(schemeert)</span>
<span class="c1">#         fwd_operator.setMesh(grid)</span>

<span class="c1">#         # Forward modeling</span>
<span class="c1">#         synth_data = schemeert.copy()</span>
<span class="c1">#         dr = fwd_operator.response(res_model)</span>

<span class="c1">#         # Add 5% random noise</span>
<span class="c1">#         dr *= 1. + pg.randn(dr.size()) * 0.05</span>

<span class="c1">#         # Set up ERT manager and save data</span>
<span class="c1">#         ert_manager = ert.ERTManager(synth_data)</span>
<span class="c1">#         synth_data[&#39;rhoa&#39;] = dr</span>
<span class="c1">#         synth_data[&#39;err&#39;] = ert_manager.estimateError(synth_data, absoluteUError=0.0, relativeError=0.05)</span>

<span class="c1">#         # Save synthetic data</span>
<span class="c1">#         synth_data.save(os.path.join(output_dir, &quot;appres/synthetic_data&quot;+str(i)+&quot;.dat&quot;))</span>

<span class="c1">#         return i, True, None  # Success</span>
<span class="c1">#     except Exception as e:</span>
<span class="c1">#         return i, False, str(e)  # Return error information</span>
</pre></div>
</div>
<p>Create output directories if they don‚Äôt exist
os.makedirs(os.path.join(output_dir, ‚Äúappres‚Äù), exist_ok=True)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># # Extract necessary data from interpolator to pass to workers</span>
<span class="c1"># interpolator_L_profile = interpolator.L_profile.copy()</span>
<span class="c1"># interpolator_surface_profile = interpolator.surface_profile.copy()</span>

<span class="c1"># # Process in parallel</span>
<span class="c1"># results = Parallel(n_jobs=2, verbose=10)(</span>
<span class="c1">#     delayed(process_timestep)(</span>
<span class="c1">#         i,</span>
<span class="c1">#         output_dir,</span>
<span class="c1">#         None,  # We&#39;ll reload the mesh from file instead of passing it</span>
<span class="c1">#         interpolator_L_profile,</span>
<span class="c1">#         interpolator_surface_profile</span>
<span class="c1">#     ) for i in range(Water_Content.shape[0])</span>
<span class="c1"># )</span>

<span class="c1"># # Check results</span>
<span class="c1"># success_count = sum(1 for _, success, _ in results if success)</span>
<span class="c1"># print(f&quot;Successfully processed {success_count} out of {len(results)} timesteps&quot;)</span>

<span class="c1"># # Print any errors</span>
<span class="c1"># for i, success, error in results:</span>
<span class="c1">#     if not success:</span>
<span class="c1">#         print(f&quot;Error in timestep {i}: {error}&quot;)</span>
</pre></div>
</div>
<p>example to load and show the synthetic data</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">syn_data</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;appres/synthetic_data&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.dat&quot;</span><span class="p">))</span>
<span class="n">ert</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">syn_data</span><span class="p">)</span>
</pre></div>
</div>
<p>load all synthetic data and plot them</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">all_syn_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Water_Content</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">syn_data</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;appres/synthetic_data&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.dat&quot;</span><span class="p">))</span>
        <span class="n">all_syn_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">syn_data</span><span class="p">[</span><span class="s1">&#39;rhoa&#39;</span><span class="p">]))</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error loading synthetic data for timestep </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>## plot the apparent resitivity</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="k">as</span> <span class="nn">pylab</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;legend.fontsize&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
          <span class="c1">#&#39;figure.figsize&#39;: (15, 5),</span>
         <span class="s1">&#39;axes.labelsize&#39;</span><span class="p">:</span> <span class="mi">13</span><span class="p">,</span>
         <span class="s1">&#39;axes.titlesize&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span>
         <span class="s1">&#39;xtick.labelsize&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span>
         <span class="s1">&#39;ytick.labelsize&#39;</span><span class="p">:</span><span class="mi">13</span><span class="p">}</span>

<span class="n">pylab</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;font.family&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Arial&quot;</span>


<span class="n">rng</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="s2">&quot;09/01/2011&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;08/30/2012&quot;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
<span class="n">precip</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_dir</span><span class="p">,</span> <span class="s2">&quot;precip.npy&quot;</span><span class="p">))</span>
<span class="n">syn_data_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">all_syn_data</span><span class="p">)</span>
<span class="n">syn_data_array</span><span class="o">.</span><span class="n">shape</span>



<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">365</span><span class="p">),</span><span class="n">precip</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">364</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Precipitation (mm)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">212</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">syn_data_array</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">cMap</span><span class="p">(</span><span class="s1">&#39;rhoa&#39;</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Measurement #&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;apparent_resistivity.tiff&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">211</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">syn_data_array</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">pg</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">cMap</span><span class="p">(</span><span class="s1">&#39;rhoa&#39;</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Apparent Resistivity (Œ©¬∑m)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>## Showing the water content model for the differnent timesteps</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">palettable.lightbartlein.diverging</span> <span class="kn">import</span> <span class="n">BlueDarkRed18_18_r</span>
<span class="n">fixed_cmap</span> <span class="o">=</span> <span class="n">BlueDarkRed18_18_r</span><span class="o">.</span><span class="n">mpl_colormap</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wc25</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synwcmodel/synwcmodel30.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc25</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cMin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water Content (-)&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Elevation (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Day 30&quot;</span><span class="p">)</span>


<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">wc150</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synwcmodel/synwcmodel150.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc150</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cMin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water Content (-)&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Elevation (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Day 150&quot;</span><span class="p">)</span>


<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">wc210</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synwcmodel/synwcmodel210.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc210</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cMin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water Content (-)&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Elevation (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Day 210&quot;</span><span class="p">)</span>


<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">wc280</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synwcmodel/synwcmodel320.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc280</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
              <span class="n">cMin</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water Content (-)&#39;</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;Elevation (m)&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Day 330&quot;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;water_content_model.tiff&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<p>## Showing the water content model for the differnent timesteps</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">14</span><span class="p">))</span>

<span class="kn">from</span> <span class="nn">palettable.lightbartlein.diverging</span> <span class="kn">import</span> <span class="n">BlueDarkRed18_18</span>
<span class="n">fixed_cmap</span> <span class="o">=</span> <span class="n">BlueDarkRed18_18</span><span class="o">.</span><span class="n">mpl_colormap</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">wc30</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synresmodel/synresmodel30.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc30</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showColorBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Distance (m)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resistivity (Œ©¬∑m)&#39;</span><span class="p">,</span> <span class="n">cMin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>



<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">wc150</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synresmodel/synresmodel150.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc150</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showColorBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Distance (m)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resistivity (Œ©¬∑m)&#39;</span><span class="p">,</span> <span class="n">cMin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>



<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">wc210</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synresmodel/synresmodel210.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc210</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span>
              <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showColorBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Distance (m)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resistivity (Œ©¬∑m)&#39;</span><span class="p">,</span> <span class="n">cMin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>


<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
<span class="n">wc280</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;synresmodel/synresmodel330.npy&quot;</span>  <span class="p">))</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">wc280</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">logScale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">showColorBar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Distance (m)&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Elevation (m)&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Resistivity (Œ©¬∑m)&#39;</span><span class="p">,</span> <span class="n">cMin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mi">3000</span><span class="p">)</span>


<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;resistivity_model.tiff&quot;</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="kn">import</span> <span class="nn">io</span>

<span class="c1"># Import your color map</span>
<span class="kn">from</span> <span class="nn">palettable.lightbartlein.diverging</span> <span class="kn">import</span> <span class="n">BlueDarkRed18_18_r</span>
<span class="n">fixed_cmap</span> <span class="o">=</span> <span class="n">BlueDarkRed18_18_r</span><span class="o">.</span><span class="n">mpl_colormap</span>

<span class="c1"># Create a list to store the frames</span>
<span class="n">frames</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># Set the DPI for consistent figure size</span>
<span class="n">dpi</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Create frames and store them in memory</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">365</span><span class="p">):</span>
    <span class="c1"># Print progress update</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing frame </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of 365&quot;</span><span class="p">)</span>

    <span class="c1"># Set up new figure for each frame - reduced height to eliminate empty space</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">])</span>

    <span class="c1"># Use more of the figure space</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Load data</span>
    <span class="n">moi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;synwcmodel/synwcmodel</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">))</span>

    <span class="c1"># Plot the data</span>
    <span class="n">ax</span><span class="p">,</span> <span class="n">cbar</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">moi</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                     <span class="n">cMap</span><span class="o">=</span><span class="n">fixed_cmap</span><span class="p">,</span> <span class="n">cMin</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">cMax</span><span class="o">=</span><span class="mf">0.32</span><span class="p">,</span>
                     <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>  <span class="c1"># Remove labels to save space</span>
                     <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Water content&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># Style adjustments</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_xaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">get_yaxis</span><span class="p">()</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([])</span>

    <span class="c1"># Add day counter with better positioning and visibility</span>
    <span class="c1"># Use transAxes to position the text in a consistent location</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Day: </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">3</span><span class="p">))</span>

    <span class="c1"># Add compact axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="s1">&#39;Distance (m)&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;Elevation (m)&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># Save to buffer instead of file</span>
    <span class="n">buf</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">BytesIO</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>  <span class="c1"># Close the figure</span>

    <span class="c1"># Convert buffer to image and append to frames</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">img</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">buf</span><span class="p">)</span>
    <span class="n">frames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">())</span>  <span class="c1"># Copy the image to ensure it stays in memory</span>
    <span class="n">buf</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All frames processed!&quot;</span><span class="p">)</span>

<span class="c1"># Save as GIF</span>
<span class="n">gif_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="s2">&quot;WCanimation.gif&quot;</span><span class="p">)</span>
<span class="c1"># The first frame&#39;s duration will be longer (500ms) to show initial state</span>
<span class="n">durations</span> <span class="o">=</span> <span class="p">[</span><span class="mi">500</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">frames</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># 100ms per frame after the first</span>

<span class="c1"># Save the GIF with optimized settings</span>
<span class="n">frames</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
    <span class="n">gif_path</span><span class="p">,</span>
    <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;GIF&#39;</span><span class="p">,</span>
    <span class="n">append_images</span><span class="o">=</span><span class="n">frames</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
    <span class="n">save_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">duration</span><span class="o">=</span><span class="n">durations</span><span class="p">,</span>
    <span class="n">loop</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>  <span class="c1"># 0 means loop forever</span>
    <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;GIF saved successfully to </span><span class="si">{</span><span class="n">gif_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> (0 minutes 0.000 seconds)</p>
<div class="sphx-glr-footer sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-ex3-time-lapse-measurement-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/0cfbb82e549de5390891f1d6fb5954b4/Ex3_Time_lapse_measurement.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">Ex3_Time_lapse_measurement.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/e6cb3270356086b6c229312a197402ed/Ex3_Time_lapse_measurement.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">Ex3_Time_lapse_measurement.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Ex5_SRT.html" class="btn btn-neutral float-left" title="Ex 5. Seismic Refraction Tomography (SRT) Forward Modeling" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Ex2_workflow.html" class="btn btn-neutral float-right" title="Ex 2. Complete Workflow: From Hydrological Models to Geophysical Inversion" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Hang Chen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>